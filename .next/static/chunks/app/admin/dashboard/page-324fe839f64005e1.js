(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[957],{24163:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var l=t(95155),i=t(12115),s=t(35695),r=t(45493),n=t(6874),d=t.n(n);function c(){let e=(0,s.useRouter)(),{data:a,status:t}=(0,r.wV)(),[n,c]=(0,i.useState)([]),[o,m]=(0,i.useState)(!1),[u,x]=(0,i.useState)({name:"",slug:"",region:"",difficulty:"Moderate",duration:1,price_min:0,price_max:0,images:[],videoUrl:"",agencyId:""}),[g,p]=(0,i.useState)(null),[h,b]=(0,i.useState)({}),[f,y]=(0,i.useState)([]),[v,j]=(0,i.useState)([]);async function N(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=e.target.files;if(t)for(let e=0;e<t.length;e++){let l=t[e];if(!l.type.startsWith("image/")){alert("Please select valid image files");continue}let i=new FileReader;i.onload=e=>{var t;let l=null==(t=e.target)?void 0:t.result;a?b(e=>({...e,images:[...e.images||[],l]})):x(e=>({...e,images:[...e.images,l]}))},i.readAsDataURL(l)}}function w(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];a?b(a=>({...a,images:(a.images||[]).filter((a,t)=>t!==e)})):x(a=>({...a,images:a.images.filter((a,t)=>t!==e)}))}async function C(){m(!0);let e=await fetch("/api/treks");c(await e.json()),m(!1)}async function k(e){e.preventDefault();let a={name:u.name,slug:u.slug,region:u.region,difficulty:u.difficulty,duration:Number(u.duration),price_range:[Number(u.price_min),Number(u.price_max)],altitude:0,best_season:[],permit_required:!1,highlights:[],itinerary:[],images:u.images.length>0?u.images:["default-trek"],safety_tips:[],map_embed_url:u.videoUrl||"",description:"",overview:"",faq:[],agencyId:u.agencyId||void 0};(await fetch("/api/treks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?(await C(),x({name:"",slug:"",region:"",difficulty:"Moderate",duration:1,price_min:0,price_max:0,images:[],videoUrl:"",agencyId:""})):alert("Failed to add trek")}function _(){p(null),b({})}async function U(e){var a,t;if(e.preventDefault(),!g)return;let l={};void 0!==h.name&&(l.name=h.name),void 0!==h.slug&&(l.slug=h.slug),void 0!==h.region&&(l.region=h.region),void 0!==h.difficulty&&(l.difficulty=h.difficulty),void 0!==h.duration&&(l.duration=Number(h.duration)),(void 0!==h.price_min||void 0!==h.price_max)&&(l.price_range=[Number(null!=(a=h.price_min)?a:0),Number(null!=(t=h.price_max)?t:0)]),void 0!==h.images&&(l.images=h.images),void 0!==h.videoUrl&&(l.map_embed_url=h.videoUrl),(await fetch("/api/treks",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:g,patch:l})})).ok?(await C(),_()):alert("Update failed")}async function D(e){confirm("Delete this trek?")&&((await fetch("/api/treks",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok?await C():alert("Delete failed"))}return(0,i.useEffect)(()=>{var l;if("loading"!==t){if("unauthenticated"===t||(null==a||null==(l=a.user)?void 0:l.role)!=="admin")return void e.replace("/admin/login");C()}},[t,a,e]),"loading"===t?(0,l.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,l.jsx)("p",{className:"text-center",children:"Loading..."})}):(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Manage treks and agencies"})]}),(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(d(),{href:"/admin/agencies",className:"px-4 py-2 rounded bg-primary text-primary-foreground hover:bg-primary/90 font-medium",children:"\uD83D\uDCCA View Agencies"}),(0,l.jsx)("button",{onClick:function(){(0,r.CI)({callbackUrl:"/admin/login",redirect:!0})},className:"px-4 py-2 rounded bg-muted text-muted-foreground hover:bg-muted/90",children:"Logout"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{className:"col-span-1 bg-card p-4 rounded",children:[(0,l.jsx)("h2",{className:"font-semibold mb-3",children:"Add Trek"}),(0,l.jsxs)("form",{onSubmit:k,className:"space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Trek Name *"}),(0,l.jsx)("input",{placeholder:"e.g., Everest Base Camp",value:u.name,onChange:e=>x({...u,name:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Slug (URL-friendly) *"}),(0,l.jsx)("input",{placeholder:"e.g., everest-base-camp",value:u.slug,onChange:e=>x({...u,slug:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Region *"}),(0,l.jsx)("input",{placeholder:"e.g., Khumbu",value:u.region,onChange:e=>x({...u,region:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Difficulty Level *"}),(0,l.jsxs)("select",{value:u.difficulty,onChange:e=>x({...u,difficulty:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900",children:[(0,l.jsx)("option",{value:"Easy",children:"Easy"}),(0,l.jsx)("option",{value:"Moderate",children:"Moderate"}),(0,l.jsx)("option",{value:"Challenging",children:"Challenging"}),(0,l.jsx)("option",{value:"Expert",children:"Expert"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Duration (days) *"}),(0,l.jsx)("input",{type:"number",placeholder:"e.g., 14",value:u.duration,onChange:e=>x({...u,duration:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",required:!0,min:"1"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Min Price (USD)"}),(0,l.jsx)("input",{type:"number",placeholder:"e.g., 1200",value:u.price_min,onChange:e=>x({...u,price_min:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",min:"0"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Max Price (USD)"}),(0,l.jsx)("input",{type:"number",placeholder:"e.g., 1800",value:u.price_max,onChange:e=>x({...u,price_max:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400",min:"0"})]})]}),(0,l.jsxs)("div",{className:"border-t pt-3 mt-3",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Upload Images"}),(0,l.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>N(e,!1),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm cursor-pointer"}),u.images.length>0&&(0,l.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,l.jsxs)("p",{className:"text-xs font-medium",children:["Uploaded Images (",u.images.length,"):"]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2",children:u.images.map((e,a)=>(0,l.jsxs)("div",{className:"relative bg-gray-100 rounded overflow-hidden",children:[(0,l.jsx)("img",{src:e,alt:"Preview ".concat(a+1),className:"w-full h-20 object-cover"}),(0,l.jsx)("button",{type:"button",onClick:()=>w(a,!1),className:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600",children:"✕"})]},a))})]}),(0,l.jsxs)("div",{className:"mt-3 pt-3 border-t",children:[(0,l.jsx)("label",{className:"block text-xs font-medium mb-2",children:"Or add image URLs manually"}),(0,l.jsx)("textarea",{placeholder:"https://example.com/image1.jpg, https://example.com/image2.jpg",value:u.images.filter(e=>!e.startsWith("data:")).join(", "),onChange:e=>{let a=e.target.value.split(",").map(e=>e.trim()).filter(Boolean),t=u.images.filter(e=>e.startsWith("data:"));x({...u,images:[...t,...a]})},className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400 text-xs h-12"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Video URL"}),(0,l.jsx)("input",{type:"url",placeholder:"https://www.youtube.com/embed/...",value:u.videoUrl,onChange:e=>x({...u,videoUrl:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Assign to Agency (Optional)"}),(0,l.jsx)("input",{type:"text",placeholder:"e.g., agency-1 (leave empty for admin-managed trek)",value:u.agencyId,onChange:e=>x({...u,agencyId:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 placeholder:text-gray-400 text-sm"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Agencies can only edit their own treks. Admins can edit all."})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 bg-accent text-white rounded",children:"Add"})})]})]}),(0,l.jsxs)("div",{className:"lg:col-span-2 bg-card p-4 rounded",children:[(0,l.jsx)("h2",{className:"font-semibold mb-3",children:"Treks"}),o?(0,l.jsx)("p",{children:"Loading…"}):(0,l.jsx)("ul",{className:"space-y-3",children:n.map(e=>{var a,t,i,s,r,n,d;return(0,l.jsxs)("li",{className:"flex items-center justify-between border-b py-2",children:[(0,l.jsx)("div",{className:"flex-1",children:g===e.id?(0,l.jsxs)("form",{onSubmit:U,className:"space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Trek Name"}),(0,l.jsx)("input",{value:null!=(a=h.name)?a:"",onChange:e=>b({...h,name:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Region"}),(0,l.jsx)("input",{value:null!=(t=h.region)?t:"",onChange:e=>b({...h,region:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Difficulty"}),(0,l.jsxs)("select",{value:null!=(i=h.difficulty)?i:"Moderate",onChange:e=>b({...h,difficulty:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1",children:[(0,l.jsx)("option",{value:"Easy",children:"Easy"}),(0,l.jsx)("option",{value:"Moderate",children:"Moderate"}),(0,l.jsx)("option",{value:"Challenging",children:"Challenging"}),(0,l.jsx)("option",{value:"Expert",children:"Expert"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Duration (days)"}),(0,l.jsx)("input",{type:"number",value:null!=(s=h.duration)?s:1,onChange:e=>b({...h,duration:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1"})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Min Price (USD)"}),(0,l.jsx)("input",{type:"number",value:null!=(r=h.price_min)?r:0,onChange:e=>b({...h,price_min:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Max Price (USD)"}),(0,l.jsx)("input",{type:"number",value:null!=(n=h.price_max)?n:0,onChange:e=>b({...h,price_max:Number(e.target.value)}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-sm mt-1"})]})]}),(0,l.jsxs)("div",{className:"border-t pt-2 mt-2",children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Upload Images"}),(0,l.jsx)("input",{type:"file",multiple:!0,accept:"image/*",onChange:e=>N(e,!0),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-xs cursor-pointer mt-1"}),h.images&&h.images.length>0&&(0,l.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,l.jsxs)("p",{className:"text-xs font-medium",children:["Images (",h.images.length,"):"]}),(0,l.jsx)("div",{className:"grid grid-cols-3 gap-1",children:h.images.map((e,a)=>(0,l.jsxs)("div",{className:"relative bg-gray-100 rounded overflow-hidden",children:[(0,l.jsx)("img",{src:e,alt:"Preview ".concat(a+1),className:"w-full h-12 object-cover"}),(0,l.jsx)("button",{type:"button",onClick:()=>w(a,!0),className:"absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600",children:"✕"})]},a))})]}),(0,l.jsxs)("div",{className:"mt-2 pt-2 border-t",children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Or add URLs"}),(0,l.jsx)("textarea",{value:(h.images||[]).filter(e=>!e.startsWith("data:")).join(", "),onChange:e=>{let a=e.target.value.split(",").map(e=>e.trim()).filter(Boolean),t=(h.images||[]).filter(e=>e.startsWith("data:"));b({...h,images:[...t,...a]})},className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-xs h-10 mt-1",placeholder:"URL1, URL2"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs font-medium",children:"Video URL"}),(0,l.jsx)("input",{type:"url",value:null!=(d=h.videoUrl)?d:"",onChange:e=>b({...h,videoUrl:e.target.value}),className:"w-full border rounded px-2 py-1 bg-white text-gray-900 text-xs mt-1",placeholder:"https://..."})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)("button",{type:"button",onClick:_,className:"px-2 py-1 bg-gray-200 rounded",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"px-2 py-1 bg-green-600 text-white rounded",children:"Save"})]})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"font-medium",children:e.name}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.region," • ",e.difficulty," • ",e.duration," days"]}),e.agencyId&&(0,l.jsxs)("div",{className:"text-xs text-blue-600 mt-1",children:["\uD83C\uDFE2 Agency: ",e.agencyId]})]})}),(0,l.jsx)("div",{className:"flex gap-2 ml-4",children:g!==e.id&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>{var a,t,l,i;p(e.id),b({name:e.name,slug:e.slug,region:e.region,difficulty:e.difficulty,duration:e.duration,price_min:null!=(l=null==(a=e.price_range)?void 0:a[0])?l:0,price_max:null!=(i=null==(t=e.price_range)?void 0:t[1])?i:0,images:e.images||[],videoUrl:e.map_embed_url||""})},className:"px-2 py-1 bg-blue-500 text-white rounded",children:"Edit"}),(0,l.jsx)("button",{onClick:()=>D(e.id),className:"px-2 py-1 bg-red-500 text-white rounded",children:"Delete"})]})})]},e.id)})})]})]})]})}},92301:(e,a,t)=>{Promise.resolve().then(t.bind(t,24163))}},e=>{var a=a=>e(e.s=a);e.O(0,[215,874,441,684,358],()=>a(92301)),_N_E=e.O()}]);