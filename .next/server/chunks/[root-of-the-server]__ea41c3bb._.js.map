{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BUNNY/Desktop/trek_scope/src/lib/auth.ts"],"sourcesContent":["import NextAuth, { type NextAuthConfig, type DefaultSession } from 'next-auth';\r\nimport Credentials from 'next-auth/providers/credentials';\r\nimport { z } from 'zod';\r\nimport crypto from 'crypto';\r\n\r\n// Extend NextAuth types\r\ndeclare module 'next-auth' {\r\n  interface Session {\r\n    user: {\r\n      id: string;\r\n      role: string;\r\n    } & DefaultSession['user'];\r\n  }\r\n  interface User {\r\n    id: string;\r\n    username: string;\r\n    role: string;\r\n  }\r\n}\r\n\r\nfunction hashPassword(password: string): string {\r\n  // Using a fixed salt for consistency\r\n  const FIXED_SALT = 'trek-mapper-salt';\r\n  return crypto.createHash('sha256').update(password + FIXED_SALT).digest('hex');\r\n}\r\n\r\nfunction verifyPassword(password: string, hash: string): boolean {\r\n  return hashPassword(password) === hash;\r\n}\r\n\r\n// Define authorized users (in production, query from database)\r\nconst AUTHORIZED_USERS = {\r\n  admin: {\r\n    id: 'admin-1',\r\n    username: 'admin',\r\n    role: 'admin',\r\n    passwordHash: 'e4ae6e8363fce7076f69cdce2a655516c0a22f89008027633c6e2001cb1b3c37', // admin123! with salt 'trek-mapper-salt'\r\n  },\r\n  agency: {\r\n    id: 'agency-1',\r\n    username: 'agency',\r\n    role: 'agency',\r\n    passwordHash: '1f41d8716d4964201737e48c2a318ed9902d9e1fb0bf92c7c17582f5e28b98d4', // agency123! with salt 'trek-mapper-salt'\r\n  },\r\n};\r\n\r\nconst credentialsSchema = z.object({\r\n  username: z.string().min(1, 'Username required'),\r\n  password: z.string().min(1, 'Password required'),\r\n});\r\n\r\nconst config = {\r\n  secret: process.env.AUTH_SECRET || process.env.NEXTAUTH_SECRET || 'dev-secret-key-change-in-production',\r\n  trustHost: true,\r\n  basePath: '/api/auth',\r\n  pages: {\r\n    signIn: '/admin/login',\r\n    error: '/admin/login',\r\n  },\r\n  providers: [\r\n    Credentials({\r\n      name: 'Credentials',\r\n      credentials: {\r\n        username: { label: 'Username', type: 'text', placeholder: 'admin' },\r\n        password: { label: 'Password', type: 'password' },\r\n      },\r\n      async authorize(credentials) {\r\n        try {\r\n          // Validate input\r\n          const parsed = credentialsSchema.safeParse(credentials);\r\n          if (!parsed.success) {\r\n            console.error('Validation error:', parsed.error);\r\n            return null;\r\n          }\r\n\r\n          const { username, password } = parsed.data;\r\n\r\n          // Find user\r\n          const user = AUTHORIZED_USERS[username as keyof typeof AUTHORIZED_USERS];\r\n          if (!user) {\r\n            console.warn(`Login attempt with unknown username: ${username}`);\r\n            return null;\r\n          }\r\n\r\n          // Verify password\r\n          if (!verifyPassword(password, user.passwordHash)) {\r\n            console.warn(`Failed login attempt for user: ${username}`);\r\n            return null;\r\n          }\r\n\r\n          // Return user object (never include password)\r\n          return {\r\n            id: user.id,\r\n            username: user.username,\r\n            role: user.role,\r\n          };\r\n        } catch (error) {\r\n          console.error('Auth error:', error);\r\n          return null;\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    // Add role to JWT token\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id;\r\n        token.role = user.role;\r\n      }\r\n      return token;\r\n    },\r\n    // Add role to session\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.id = token.id as string;\r\n        session.user.role = token.role as string;\r\n      }\r\n      return session;\r\n    },\r\n    // Redirect after login\r\n    async redirect({ url, baseUrl }) {\r\n      // Prevent open redirect vulnerability\r\n      if (url.startsWith('/')) return `${baseUrl}${url}`;\r\n      if (new URL(url).origin === baseUrl) return url;\r\n      return baseUrl;\r\n    },\r\n  },\r\n  events: {\r\n    async signIn({ user, account, profile, isNewUser }) {\r\n      console.log(`User signed in: ${user.username} (${user.role})`);\r\n    },\r\n    async signOut() {\r\n      console.log('User signed out');\r\n    },\r\n  },\r\n  session: {\r\n    strategy: 'jwt',\r\n    maxAge: 24 * 60 * 60, // 24 hours\r\n    updateAge: 60 * 60, // Update every 1 hour\r\n  },\r\n  jwt: {\r\n    maxAge: 24 * 60 * 60, // 24 hours\r\n  },\r\n  // Security: Enable secure cookies in production\r\n  useSecureCookies: process.env.NODE_ENV === 'production',\r\n} satisfies NextAuthConfig;\r\n\r\nexport const { handlers, auth, signIn, signOut } = NextAuth(config);\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/BUNNY/Desktop/trek_scope/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import { handlers } from '@/lib/auth';\r\n\r\nexport const { GET, POST } = handlers;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,oHAAA,CAAA,WAAQ","debugId":null}}]
}